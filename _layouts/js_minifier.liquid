{%- comment -%} Удаляем однострочные комментарии {%- endcomment -%}
{%- assign contentArray = content | split: "
" -%}
{%- assign content = "" -%}
{%- for part in contentArray -%}
	{%- assign aux = part | remove: "://" | split: "//" -%}
	{%- if aux.size == 2 -%}
		{%- assign aux = aux[1] | prepend: "//" -%}
		{%- assign aux = part | remove: aux -%}
		{%- assign content = content | append: aux | append: "
" -%}
	{%- else -%}
		{%- assign content = content | append: part | append: "
" -%}
	{%- endif -%}
{%- endfor -%}
{%- comment -%} Удаляем многострочные комментарии {%- endcomment -%}
{%- assign new_comment_tag = "2e57la4G82XMQr9K" -%}
{%- assign content = content | replace: "/*", new_comment_tag | replace: "*/", new_comment_tag -%}
{%- assign contentArray = content | split: new_comment_tag -%}
{%- assign content = "" -%}
{%- for part in contentArray -%}
	{%- assign mod = forloop.index | modulo: 2 -%}
	{%- if mod != 0 -%}
		{%- assign content = content | append: part -%}
	{%- endif -%}
{%- endfor -%}
{%- comment -%} Обрабатываем экранированные символы, обозначающие строки в JS {%- endcomment -%}
{%- assign strMasks = "dWf4Ay83kQ34n8r0 EM9145U330jDswtN G414z30q4068XB00" | split: " " -%}
{%- for mask in strMasks -%}
	{%- assign content = content | replace: "\'", mask -%}
	{%- assign content = content | replace: '\"', mask -%}
	{%- assign content = content | replace: "\`", mask -%}
{%- endfor -%}
{%- comment -%} Маркируем участки, кода со строками {%- endcomment -%}
{%- assign marker = "2e57la4G82XMQr9K" -%}
{%- assign aux = marker | append: '"' -%}
{%- assign content = content | replace: '"', aux -%}
{%- assign aux = marker | append: "'" -%}
{%- assign content = content | replace: "'", aux -%}
{%- assign aux = marker | append: "`" -%}
{%- assign content = content | replace: "`", aux -%}

{%- assign contentArray = content | split: marker -%}
{%- assign content = "" -%}
{%- assign simbols = "= + - / * , % > < : ; ( ) { } [ ]" | split: " " -%} {%- comment -%} Удаляем пробелы вокруг этих символов {%- endcomment -%}
{%- for part in contentArray -%}
	{%- assign mod = forloop.index | modulo: 2 -%}
	{%- if mod == 1 -%}
		{%- comment -%} Удаляем табуляции и переносы строк {%- endcomment -%}
		{%- assign partModified = part | remove: "	" | remove: "
"-%}
		{%- comment -%} Удаляем двойные пробелы {%- endcomment -%}
		{%- assign partModified_size = partModified | size -%}
		{%- for i in (1 .. 100) -%}
			{%- assign partModified = partModified | remove: "  " -%}
			{%- if partModified.size == partModified_size -%}
				{%- break -%}
			{%- else -%}
				{%- assign partModified_size = partModified | size -%}
			{%- endif -%}
		{%- endfor -%}
		{%- comment -%} Удаляем пробелы вокруг символов из simbols {%- endcomment -%}
		{%- for s in simbols -%}
			{%- assign aux = s | append: " " -%}
			{%- assign partModified = partModified | replace: aux, s -%}
			{%- assign aux = s | prepend: " " -%}
			{%- assign partModified = partModified | replace: aux, s -%}
		{%- endfor -%}
		{%- assign content = content | append: partModified -%}
	{%- else -%}
		{%- assign content = content | append: part -%}
	{%- endif -%}
{%- endfor -%}
{%- for mask in strMasks -%}
	{%- assign content = content | replace: mask, "'" -%}
	{%- assign content = content | replace: mask, '"' -%}
	{%- assign content = content | replace: mask, "`" -%}
{%- endfor -%}

{%- comment -%} Начинаем блок замены имён {%- endcomment -%}
{%- assign newNames = "a b c d e f g h i j k l m n o p q r s t u v w x y z" | split: " " -%}
{%- assign newNamesIndex = 1 -%}
{%- comment -%} Замена имён функций {%- endcomment -%}
{%- assign contentArray = content | split: "function" -%}
{%- assign names = "" | split: " " -%}
{%- for part in contentArray offset: 2 -%}
	{%- assign aux = part | slice: 0, 1 -%}
	{%- if aux != "(" -%}
		{%- assign name = part | replace: "(", " " | truncatewords: 1, "" | append: "2e57la4G82XMQr9K" | split: "2e57la4G82XMQr9K" -%}
		{%- assign names = names | concat: name -%}
	{%- endif -%}
{%- endfor -%}
{%- for name in names-%}
	{%- assign aux = forloop.index -%}
	{%- assign nameModified = name | append: "(" -%}
	{%- assign newName = newNames[aux] | append: "(" -%}
	{%- assign content = content | replace: nameModified, newName -%}
	{%- if forloop.last -%}
		{%- assign newNamesIndex = forloop.length -%}
	{%- endif -%}
{%- endfor -%}
{%- comment -%} Замена имён констант {%- endcomment -%}
{%- assign contentArray = content | split: "const" -%}
{%- assign names = "" | split: " " -%}
{%- for part in contentArray offset: 2 -%}
	{%- assign aux = part | slice: 0, 1 -%}
	{%- if aux == " " -%}
		{%- assign name = part | replace: "=", " " | truncatewords: 1, "" | append: "2e57la4G82XMQr9K" | split: "2e57la4G82XMQr9K" -%}
		{%- assign names = names | concat: name -%}
	{%- endif -%}
{%- endfor -%}
{%- for name in names-%}
	{%- assign aux = forloop.index | plus: newNamesIndex -%}
	{%- assign nameModified = name -%}
	{%- assign newName = newNames[aux] -%}
	{%- assign content = content | replace: nameModified, newName -%}
	{%- if forloop.last -%}
		{%- assign newNamesIndex = forloop.length | plus: newNamesIndex -%}
	{%- endif -%}
{%- endfor -%}
{{ content }}
{{ newNamesIndex }}



